---
sidebar_position: 5
---

# 4ì£¼

- ì‚¬ìš©ìë¡œë¶€í„°ì˜ ë°ì´í„° ì…ë ¥, form, react-hook-form, validation ì‚¬ìš© - 1

---

1. useLayoutEffect
   [ğŸ‘‰ğŸ”—](https://raw.githubusercontent.com/donavon/hook-flow/master/hook-flow.png)
   [ğŸ‘‰ğŸ”—](https://raw.githubusercontent.com/donavon/hook-flow/master/hook-flow.png)

---

- ì½ì–´ë³´ê¸° MDN DOCS [ğŸ‘‰ğŸ”—](https://developer.mozilla.org/en-US/docs/Learn/Forms/Sending_forms_through_JavaScript)
- react-hook-form [ğŸ‘‰ğŸ”—](https://react-hook-form.com/get-started#Quickstart)
- validation with react-hook-form [ğŸ‘‰ğŸ”—](https://react-hook-form.com/get-started#SchemaValidation)

- ìœ„ ê°€ì´ë“œì— ë”°ë¼ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¸ìŠ¤í†¨ í•œë‹¤

```bash
# í´ë¼ì´ì–¸íŠ¸ì—ì„œë§Œ ì‚¬ìš©ë˜ë¯€ë¡œ devDependencyë¡œ ì„¤ì¹˜
npm install react-hook-form --save-dev
npm install @hookform/resolvers --save-dev
# ì„œë²„ì—ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ dependencyë¡œ ì„¤ì¹˜
npm install yup
```

- ë¨¼ì €, ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  formì— ëŒ€í•´ ì•Œì•„ë³´ì
- routes/amongAuth.tsx ìƒì„±

```tsx
import { MouseEventHandler } from "react";
import { cx } from "../helpers/util";

const radioList = ["email", "character", "phone"];

const AmongAuth = () => {
  const handleSubmit: MouseEventHandler<HTMLFormElement> = (e) => {
    e.preventDefault();
    // MDN ë¬¸ì„œ ê´€ìŠµì„ ë”°ë¼ FDë¡œ ë„¤ì´ë°
    const FD = new FormData(e.currentTarget);
    // get checkbox data
    // ex) ['email', 'character', 'phone']
    console.log(FD.getAll("resources"));
    // get others data
    // ex) {resources: 'phone', clientId: '', secretKey: ''}
    // ìœ„ resourcesì—ëŠ” ì²˜ìŒ ì²´í¬ëœ ê°’ì´ ì…ë ¥ë˜ì—ˆë‹¤ ìœ„ getAllì˜ ê°’ìœ¼ë¡œ ë³€í™˜ì´ í•„ìš”í•˜ë‹¤
    const data = Object.fromEntries(FD);
    console.log(data);
  };

  return (
    <div className="flex flex-col w-full">
      <label className="label">
        <span className="label-text text-accent/60">Client ID ìˆ˜ë™ ìƒì„±</span>
      </label>
      <form className="flex flex-col gap-2 py-2" onSubmit={handleSubmit}>
        <div className="flex flex-row justify-around form-control">
          {radioList.map((item, index) => (
            <div
              key={index}
              className="flex flex-row items-center justify-center align-middle form-control"
            >
              <label className="label">
                <span className="label-text">{`${item
                  .charAt(0)
                  .toUpperCase()}${item.slice(1)}`}</span>
              </label>
              <input
                type="checkbox"
                name="resources"
                value={item}
                className={cx(
                  "checkbox",
                  item === radioList[0] && "radio-primary",
                  item === radioList[1] && "radio-secondary",
                  item === radioList[2] && "radio-accent"
                )}
              />
            </div>
          ))}
        </div>
        <div className="form-control drop-shadow">
          <input
            name="clientId"
            type="text"
            placeholder="CLIENT IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
            className="w-full input input-bordered input-md "
          />
        </div>
        <div className="form-control drop-shadow">
          <input
            name="secretKey"
            type="text"
            placeholder="SECRET KEYë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
            className="w-full input input-bordered input-md "
          />
        </div>
        <div className="flex justify-end">
          <button
            type="submit"
            className="btn btn-primary drop-shadow glass bg-primary hover:btn-secondary"
          >
            ìˆ˜ë™ìƒì„±
          </button>
        </div>
      </form>
    </div>
  );
};

export default AmongAuth;
```

- react-hook-form, validationì„ ì ìš©

```tsx
import { useState } from "react";
import { useForm } from "react-hook-form";
import { yupResolver } from "@hookform/resolvers/yup";
import * as yup from "yup";
import { cx } from "../helpers/util";

interface IFormInputs {
  clientId: string;
  secretKey: string;
  resources: string[];
}

const schema = yup
  .object({
    secretKey: yup.string().required(),
    clientId: yup.string().required(),
    resources: yup.array().nullable().required().min(1),
  })
  .required();

const radioList = ["email", "character", "phone"];

const AmongAuth = () => {
  const [isProcessing, setIsProcessing] = useState(false);
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<IFormInputs>({
    resolver: yupResolver(schema),
  });

  const onSubmit = async (data: IFormInputs) => {
    try {
      if (isProcessing) return;
      setIsProcessing(true);
    } catch (error) {
    } finally {
      setIsProcessing(false);
    }
  };

  return (
    <div className="flex flex-col w-full">
      <label className="label">
        <span className="label-text text-accent/60">Client ID ìˆ˜ë™ ìƒì„±</span>
      </label>
      <form
        className="flex flex-col gap-2 py-2"
        onSubmit={handleSubmit(onSubmit)}
      >
        <div className="flex flex-row justify-around form-control">
          {radioList.map((item, index) => (
            <div
              key={index}
              className="flex flex-row items-center justify-center align-middle form-control"
            >
              <label className="label">
                <span className="label-text">{`${item
                  .charAt(0)
                  .toUpperCase()}${item.slice(1)}`}</span>
              </label>
              <input
                type="checkbox"
                value={item}
                className={cx(
                  "checkbox",
                  (errors.resources && "input-error") ||
                    (item === radioList[0] && "radio-primary") ||
                    (item === radioList[1] && "radio-secondary") ||
                    (item === radioList[2] && "radio-accent")
                )}
                {...register("resources")}
              />
            </div>
          ))}
        </div>
        <p className="flex justify-center -mt-2 text-xs text-error">
          {errors.resources?.message}
        </p>
        <div className="form-control drop-shadow">
          <input
            type="text"
            placeholder="CLIENT IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
            className={cx(
              "w-full input input-bordered input-md",
              errors.clientId && "input-error"
            )}
            {...register("clientId")}
          />
          <p className="text-xs text-error">{errors.clientId?.message}</p>
        </div>
        <div className="form-control drop-shadow">
          <input
            type="text"
            placeholder="SECRET KEYë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
            className={cx(
              "w-full input input-bordered input-md",
              errors.secretKey && "input-error"
            )}
            {...register("secretKey")}
          />
          <p className="text-xs text-error">{errors.secretKey?.message}</p>
        </div>
        <div className="flex justify-end">
          <button
            type="submit"
            className={cx(
              "btn btn-outline bg-primary glass hover:btn-secondary min-w-[16%]",
              isProcessing && "loading btn-disabled"
            )}
          >
            ìˆ˜ë™ìƒì„±
          </button>
        </div>
      </form>
    </div>
  );
};

export default AmongAuth;
```

- yup schemaíŒŒì¼ì„ ë¶„ë¦¬í•œë‹¤
- src/yup/amongAuthSchema.ts ìƒì„±

```ts
import * as yup from "yup";

export interface IClientIdForm {
  clientId: string;
  secretKey: string;
  resources: string[];
}

export const clientIdSchema = yup
  .object({
    secretKey: yup.string().required(),
    clientId: yup.string().required(),
    resources: yup.array().nullable().required().min(1),
  })
  .required();
```

- routes/amonaAuth.tsx ìˆ˜ì •

```tsx
...
import { IClientIdForm, clientIdSchema } from '../yup/amongAuthSchema';

const radioList = ['email', 'character', 'phone'];

const AmongAuth = () => {
  const [isProcessing, setIsProcessing] = useState(false);
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<IClientIdForm>({
    resolver: yupResolver(clientIdSchema),
  });

  const onSubmit = async (data: IClientIdForm) => {
    try {
      if (isProcessing) return;
      setIsProcessing(true);
    } catch (error) {
    } finally {
      setIsProcessing(false);
    }
  };

...
```

- ë°ì´í„° ì²˜ë¦¬ ê³¼ì •ì—ì„œ ì²˜ë¦¬ ì‹œê°„ì„ ì§€ì—°ì‹œì¼œ ë°ì´í„° ì²˜ë¦¬ì¤‘ì¼ë•Œì˜ stateë¥¼ ê´€ë¦¬í•´ë³´ì
- routes/amonaAuth.tsx ìˆ˜ì •

```tsx
...
const onSubmit = async (data: IClientIdForm) => {
    try {
      if (isProcessing) return;
      setIsProcessing(true);
      console.log(data);
      // 1s delay
      await new Promise((resolve, reject) => {
        setTimeout(resolve, 1000);
      });
    } catch (error) {
      console.log(error);
    } finally {
      setIsProcessing(false);
    }
  };
...
```

- ë²„íŠ¼ì˜ UI ë³€í™” ë° ì¤‘ë³µí´ë¦­ ë°©ì§€ í™•ì¸
- ë°ì´í„° ì²˜ë¦¬ì¤‘ì˜ stateëŠ” ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œë„ ì‚¬ìš©ë  ê°€ëŠ¥ì„±ì´ ë†’ìœ¼ë¯€ë¡œ, ê´€ë ¨ ê¸°ëŠ¥ì„ hookë¡œ ë§Œë“¤ì–´ ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ í•œë‹¤

- hooks/useProcessing.ts ìƒì„±

```ts
import { useState } from "react";

export const useProcessing = () => {
  const [isProcessing, setIsProcessing] = useState(false);

  const registeHandler = async (cb: () => void) => {
    if (isProcessing) return;
    try {
      setIsProcessing(true);
      await cb();
    } catch (error) {
      throw error;
    } finally {
      setIsProcessing(false);
    }
  };

  return { isProcessing, registeHandler };
};
```

- routes/amonaAuth.tsx ìˆ˜ì •

```tsx
...
import { useProcessing } from '../hooks/useProcessing';

const radioList = ['email', 'character', 'phone'];

const AmongAuth = () => {
  const { isProcessing, registeHandler } = useProcessing();
  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<IClientIdForm>({
    resolver: yupResolver(clientIdSchema),
  });

  const onSubmit = async (data: IClientIdForm) => {
    try {
      await registeHandler(async () => {
        await new Promise((resolve, reject) => {
          setTimeout(resolve, 1000);
        });
      });
    } catch (error) {
      console.log(error);
    }
  };

...
```

- useProcessingì˜ useStateë¥¼ recoilì—ì„œ ê´€ë¦¬í•˜ê²Œ ë˜ë©´ useProcessingì—ì„œ isProcessingë¥¼ í™•ì¸í•˜ëŠ” ëª¨ë“  ì»´í¬ë„ŒíŠ¸ì—ì„œ ë™ì¼í•œ stateë¥¼ ìœ ì§€í•  ìˆ˜ ìˆë‹¤
