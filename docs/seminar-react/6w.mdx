---
sidebar_position: 7
---

# 6ì£¼

- íŒŒì¼ì—…ë¡œë“œ, file-pond ì‚¬ìš© - 1

---

1. file-pond ì ìš©
2. ì½”ë“œ ë¦¬ë·°

---

- react file-pond [ğŸ‘‰ğŸ”—](https://www.npmjs.com/package/react-filepond)
- file-pond docs [ğŸ‘‰ğŸ”—](https://pqina.nl/filepond/docs/api/server/)
- axios docs [ğŸ‘‰ğŸ”—](https://github.com/axios/axios/blob/main/examples/upload/index.html)

- serverê´€ë ¨ ì½”ë“œë¥¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• í•˜ë ¤í•˜ë¯€ë¡œ ê´€ë ¨í•œ file-pondì˜ ë¬¸ì„œì™€, axiosì‚¬ìš©ì‹œ ì§„í–‰ì‚¬í•­ ë° ì¤‘ë‹¨ ì²˜ë¦¬ ê´€ë ¨ì‚¬í•­ì„ í™•ì¸í•œë‹¤

- install file-pond

```bash
npm install react-filepond filepond --save-dev
npm i filepond-plugin-image-preview filepond-plugin-image-exif-orientation --save-dev
```

- src/components/FileUpload.tsx íŒŒì¼ìƒì„±

```tsx
import { useLayoutEffect, useState } from 'react';
import { FilePond, registerPlugin } from 'react-filepond';
import FilePondPluginImageExifOrientation from 'filepond-plugin-image-exif-orientation';
import FilePondPluginImagePreview from 'filepond-plugin-image-preview';

import 'filepond/dist/filepond.min.css';
import 'filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css';
import axios, { AxiosProgressEvent } from 'axios';

// Register the plugins
registerPlugin(FilePondPluginImageExifOrientation, FilePondPluginImagePreview);

const FileUpload = () => {
  const [data, setData] = useState(null);

  useLayoutEffect(() => {
    const el = document.querySelector('.filepond--credits') as HTMLAnchorElement;
    el.innerText = '';
  }, []);

  return (
    <div className="flex flex-col justify-center w-full h-full gap-4 p-2">
      <div className="flex w-full">
        <div className="w-full mockup-code">
          <pre data-prefix="*" className="bg-error text-warning-content">
            <code>-</code>
          </pre>
          <pre data-prefix="*" className="bg-warning text-warning-content">
            <code>maybe need a gameCode to make path of upload</code>
          </pre>
          <pre data-prefix="*" className="bg-warning text-warning-content">
            <code>check wiki, -</code>
          </pre>
        </div>
      </div>
      <div className="flex flex-row h-full gap-2">
        <div className="flex flex-col w-[50%]">
          <FilePond
            allowMultiple={false}
            maxFiles={1}
            instantUpload={false}
            server={{
              process: async (_fieldName, file, _metadata, _load, error, progress, abort, _transfer, _options) => {
                const data = new FormData();
                console.log(file);
                data.append('files', file);
                const controller = new AbortController();

                try {
                  const response = await axios.post('/fileupload', data, {
                    signal: controller.signal,
                    onUploadProgress: (progressEvent: AxiosProgressEvent) => {
                      progress(!!progressEvent.total, progressEvent.loaded, progressEvent.total || 0);
                    },
                  });
                  setData(response?.data || null);
                  console.log(response);
                } catch (err) {
                  error('oh no');
                }
                return {
                  abort: () => {
                    controller.abort();
                    abort();
                  },
                };
              },
            }}
            labelIdle='Drag & Drop your files or <span class="filepond--label-action">Browse</span>'
          />
        </div>
        <div className="w-[50%] drop-shadow bg-base-100 rounded-md">
          <pre>{JSON.stringify(data, null, 2)}</pre>
        </div>
    </div>
  );
};

export default FileUpload;
```

- src/routes/amongAuth.tsx ì— íŒŒì¼ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸ë¥¼ ì¶”ê°€í•œë‹¤

```tsx
...
      </form>
      <div className="divider" />
      <FileUpload />
...
```

- ì„œë²„ìª½ ì½”ë“œë¥¼ ì¶”ê°€í•œë‹¤
- server/api/fileupload.ts ìƒì„±

```ts
import { Router } from "express";
import { createProxyMiddleware } from "http-proxy-middleware";
import dotenv from "dotenv";

const config = dotenv.config().parsed;

const router = Router();

router.post(
  "/fileupload",
  createProxyMiddleware({
    target: config?.FILE_UPLOAD_URL,
    changeOrigin: true,
    pathRewrite: (_path, _req) => {
      return "/file/upload";
    },
  })
);

export default router;
```

- .envì— í™˜ê²½ë³€ìˆ˜ ì¶”ê°€

```txt
SERVER_PORT=4000
OKTA_ISSUER=-
OKTA_CLIENT_ID=-
OKTA_SCOPES=email,openid,profile
FILE_UPLOAD_URL=-
DANGEROUSLY_DISABLE_HOST_CHECK=true
```

- server/api/index.ts íŒŒì¼ ìˆ˜ì •

```ts
import { Router } from "express";
import health from "./health";
import mconsole from "./mconsole";
import fileupload from "./fileupload";

const router = Router();

router.use(health);
router.use(mconsole);
router.use(fileupload);

export default router;
```

- íŒŒì¼ì—…ë¡œë“œ ì»´í¬ë„ŒíŠ¸ì—ì„œ file-pondë¥¼ ì‚¬ìš©ì‹œ serverì— ìš”ì²­í•˜ëŠ” ë¡œì§ì„ ì»¤ìŠ¤í„°ë§ˆì´ì§• í–ˆë‹¤
- ë¬¸ì„œë¥¼ ë³´ë©´ì„œ axiosë¡œ ìš”ì²­ì„ ë³´ë‚´ê³  ì—…ë¡œë“œ ì§„í–‰ì‚¬í•­ ê´€ë ¨ ì´ë²¤íŠ¸ë¥¼ í†µí•´ file-pondì— ì§„í–‰ì‚¬í•­ì„ ì „ë‹¬í•œë‹¤
- ì—…ë¡œë“œ ì¤‘ë‹¨ê´€ë ¨ ë¡œì§ì„ í™•ì¸í•œë‹¤

```tsx
<FilePond
  allowMultiple={false}
  maxFiles={1}
  instantUpload={false}
  server={{
    process: async (
      _fieldName,
      file,
      _metadata,
      _load,
      error,
      progress,
      abort,
      _transfer,
      _options
    ) => {
      const data = new FormData();
      console.log(file);
      data.append("files", file);
      const controller = new AbortController(); // ì—…ë¡œë“œ ì¤‘ë‹¨

      try {
        const response = await axios.post("/fileupload", data, {
          signal: controller.signal, // ì—…ë¡œë“œ ì¤‘ë‹¨
          onUploadProgress: (progressEvent: AxiosProgressEvent) => {
            // ì§„í–‰ì‚¬í•­ ì²˜ë¦¬
            progress(
              !!progressEvent.total,
              progressEvent.loaded,
              progressEvent.total || 0
            );
          },
        });
        setData(response?.data || null);
        console.log(response);
      } catch (err) {
        error("oh no");
      }
      return {
        // ì—…ë¡œë“œ ì¤‘ë‹¨
        abort: () => {
          controller.abort();
          abort();
        },
      };
    },
  }}
  labelIdle='Drag & Drop your files or <span class="filepond--label-action">Browse</span>'
/>
```
